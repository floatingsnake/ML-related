# Faster-RCNN

### Arch

![image.png](https://i.loli.net/2021/11/05/eHZVn7McS9Jp61U.png)

- RPN用来生成候选框

- 候选框结合Feature Maps输入到最终的分类回归网络中

- Faster-RCNN Loss:

  ​	**RPN_cls+RPN_regr+Final_cls+Final_reg**

### RPN

![image.png](https://i.loli.net/2021/11/05/rhAIbUBlK9FNoQ1.png)

- 从FeatrueMap的中心点映射到原图，得到K个box，然后算出每个box对应的**分类** (Pos/Neg)得分以及**回归** (Gt和Pd偏移量)

- 用IoU来去除冗余框

- RPN-Loss：

  ![image.png](https://i.loli.net/2021/11/05/HS1zDsemdno3qJ7.png)

# SAPD

## Arch

![image.png](https://i.loli.net/2021/11/05/kwfsJerQ2VD1SOi.png)

- diff pyramid-level generated by diff **featrue stride**

- per pyramid pixel对应到原图的点，然后和gt_box算loss

  

## Loss

![image.png](https://i.loli.net/2021/11/05/dyTZnPJxA8Vue9I.png)

![image.png](https://i.loli.net/2021/11/05/yNmnGZMWLtbYP8g.png)

- 当pixel对应在原图的点，在Gt-shrunk-Box里面，这个anchor_point(pixel at $l_{th}$ level)被设置为pos

- Focal Loss + Ious Loss

  - Focal Loss : 交叉熵loss的变体，用于解决样本不平衡问题

    ![image.png](https://i.loli.net/2021/11/05/l1skV9nF3JoatWb.png)

##  Soft-Weighted Anchor Points

- 为了解决False-attention问题，提出soft-weighted方法，让网络将注意力集中到在gt-box中心的pixel，减少对临近边界的pixel。

### Struct

![image.png](https://i.loli.net/2021/11/05/asomGWYCzwxOIVd.png)

###  soft-weight compute

![image.png](https://i.loli.net/2021/11/05/21eScaW34TtMuBE.png)

![image.png](https://i.loli.net/2021/11/05/mnUKhBoHtdrTYsq.png)

## Soft-Selected Pyramid Levels

![image.png](https://i.loli.net/2021/11/05/TUOtq6RvzeAS4ln.png)

- 给了Pyramid每个level过一层RoIAlign，然后concatenate到一起，再经过featrue selection net得到每一层的**权重**$w_l^{B}$，将soft-weight系数计算**重写**为：

  

![image-20211105152747926](C:\Users\sunq1\AppData\Roaming\Typora\typora-user-images\image-20211105152747926.png)

- Loss：

![image-20211105152914140](C:\Users\sunq1\AppData\Roaming\Typora\typora-user-images\image-20211105152914140.png)





# YOLO

## V3

- **Darknet-53**

  使用Darknet-53，没有池化层和全连接层，用卷积层步长变化来变换张量尺寸。输出是上采样多层拼接

- **Bounding Box Prediction**

  预测相对位置，bb中心对网格左上角的相对坐标
